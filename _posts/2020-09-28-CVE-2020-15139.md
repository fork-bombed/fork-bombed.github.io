---
title: "CVE-2020-15139: From Self-XSS to Persistent DOM-XSS"
author: Murphy
date: 2020-09-28 00:00:00 +0100
categories: [Misc]
tags: [xss, bug bounty]
---

A few months back I was playing around with a forum framework called MyBB. Back before Discord and other chat platforms, forums were the main way to communicate with other people with similar interests online. I've been on different forum sites related to programming and security for as long as I can remember - all of which used MyBB to run. I'm very familiar with MyBB from a user perspective, so I decided to start playing around with some of the inputs to see what would happen.

## Finding a Self-XSS

About a year ago I discovered I could get a self-XSS by altering the text in the `[font]` tags. It turns out that `[font=Arial Black]` would convert to `<font face="Arial Black">`, so I tried to escape the `face` attribute. Sure enough, sending in `[font=Arial Black"]` resulted in `<font face="Arial Black" "="">` which meant I was able to escape the tag and add another attribute successfully. 

Once I knew I could write my own attributes, it was time to see if I could execute a script. I used the `onclick` attribute so that, when the text was clicked, it would execute some JavaScript. I used the payload `[font=Arial Black"onclick="alert(1)]Click me[/font]` which resulted in `<font face="Arial Black" onclick="alert(1)">Click me</font>`. I could now execute scripts when clicking the text.

![Self XSS]({{ "assets/img/2/selfxss.gif" | relative_url }})

At this point, I didn't have a lot of experience with XSS attacks, so I couldn't really figure out what to do next. It was only a self-XSS, so it wasn't worth reporting and I just forgot about it.

## Upgrading to Persistent DOM-XSS

A few months ago, a friend of mine asked me to help test a new feature in his MyBB forum for vulnerabilities. I played around with it for a little while and within 30 minutes I had a stored XSS. I reported it to my friend and got it fixed, but it gave me some motivation to play around with the MyCode self-XSS I found a year back.

I created a new test thread in a hidden section and started messing around and sure enough, the self-XSS still works. I had a little more experience by this point, so I started messing around with other tags such as `[size]` and `[align]`. I took the `[size]` tag and altered the style tag to change the text colour to blue using `[size=;color:blue]this text is blue[/size]`. When I went back to the live view in WYSIWYG (What You See Is What You Get) editor, I saw that the text was indeed blue. At this point I decided to post the thread but, unfortunately, it had been filtered out, so it just contained the raw payload that I had written earlier. I went back to edit the post and noticed that the editor still showed the text as blue, even though the post had been filtered. This meant that the editor was interpreting the raw message and converting it into HTML without any filtering or checks.

With this in mind, I checked to see if I could escape the `style` attribute, and added an `onmouseover` event to trigger an alert via JavaScript:
```
[size=;color:blue"onmouseover="alert(1)]this text is blue[/size]
```

I updated the thread, replied to the post using the WYSIWYG editor, moved my mouse over the text and got an alert box at the top of my page. I had a successful persistent DOM-XSS now, but it wasn't very useful as the user had to move their mouse over the text for the attack to work. I decided to close the tag and try write an `img` tag that would run JavaScript when the image fails to load, and pointed the source to an invalid file, which would cause an error and trigger the `onerror` event. Here's the payload we have now:
```
[size=;color:blue"><img/onerror="alert('XSS')"/src="image"/>]this text is blue[/size]
```
And boom, as soon as the page loaded an alert popped up on my screen with the word "XSS".

## Proof of Concept

For those that just came for the PoCs, here you go. This also works with a variety of other tags such as `align`, `quote`, and `font`.

```
[size=10;"><img/onerror="alert(1)"/src=1/>]PoC[/size]

[align=center;"><img/onerror="alert(1)"/src=1/>]PoC[/align]
```

## Conclusions

This is quite a simple exploit and could easily be used for malicious purposes. All it takes is for someone to reply to the post (or PM) and the JavaScript will be executed on their browser. From there, an attacker could create wormable code that could make malicious posts and PMs from other users on the site. Fortunately the MyBB team were quick to reply to my report and solved the problem within the week I reported it.

This was my first CVE and was a lot of fun to discover. It gave me a massive boost in confidence and shows that you don't need a whole lot of experience to find vulnerabilities in popular software. If you put in the time and effort, you're bound to come across something!

Here's some links to the security advisory and CVE on NIST:

https://nvd.nist.gov/vuln/detail/CVE-2020-15139
https://github.com/mybb/mybb/commit/37ad29dcd25489a37bdd89ebac761f22492558b0
https://github.com/mybb/mybb/security/advisories/GHSA-37h7-vfv6-f8rj
https://mybb.com/versions/1.8.24/
